name: Daily News Update

on:
  schedule:
    # Run at 16:00 UTC (8:00 AM PST) every day
    - cron: '0 16 * * *'
  workflow_dispatch: # Allows manual triggering from GitHub UI

jobs:
  update-news:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4

      - name: Locate and Run Script
        run: |
          echo "DEBUG: Listing all files to find the script..."
          find . -maxdepth 3 -not -path '*/.*'
          
          if [ -f "gather_news.py" ]; then
            echo "SUCCESS: Found script in root directory."
            python gather_news.py
          elif [ -f "bayarea_market_pulse/gather_news.py" ]; then
            echo "SUCCESS: Found script in bayarea_market_pulse directory."
            cd bayarea_market_pulse
            python gather_news.py
          else
            echo "ERROR: Could not find gather_news.py anywhere!"
            exit 1
          fi

      - name: Commit and push changes
        run: |
          git config --global user.name 'GitHub Action'
          git config --global user.email 'action@github.com'
          git add .
          git diff --quiet && git diff --staged --quiet || (git commit -m "Daily news update [skip ci]" && git push)
